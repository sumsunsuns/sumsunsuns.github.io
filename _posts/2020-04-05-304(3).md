---
layout:     post
title:     304号测试--main函数分析
subtitle:   
date:       2020-04-05
author:     SGQ
header-img: img/post-sgq-20200319.jpg
catalog: true
tags:
    - IDA
    - 汇编语言
    - 
    - 
---

## 前言：


   









## main函数反汇编代码：
```
 int __fastcall main(int, char * * , char  * *)
 
main            proc near               ; DATA XREF: start+1D↑o

;   __unwind {
                push    	r14
                push    	rbx
                push    	rax
                mov         rbx, rsi
                cmp    		edi, 2
                jnz   		short loc_C47
                lea   		rsi, handler     ;handler       
                mov         edi, 2          ; sig
                call   		signal
                mov    		rdi, [rbx+8]
                call  		sub_CE0
                mov  		rbx, rax
                lea  	    r14, unk_202014
                mov         dword ptr [r14], 1
                nop       word ptr [rax+rax+00000000h]

loc_C10:                                ; CODE XREF: main+50↓j

               mov          rdi, rbx
               call  		sub_E90
               test  		eax, eax
               jnz  		short loc_C24
               cmp  		dword ptr [r14], 0
               jnz          short loc_C10
               jmp          short loc_C35

 loc_C24:                                ; CODE XREF: main+4A↑j
                cmp     eax, 2
                jnz     short loc_C35
                lea     rdi, s          ; "Illegal Instruction"
                call      puts

 loc_C35:                                ; CODE XREF: main+52↑j
                                        ; main+57↑j
                mov      rdi, rbx
                call     nullsub_1

 loc_C3D:                                ; CODE XREF: main+92↓j
                xor     eax, eax
                add     rsp, 8
                pop     rbx
                pop     r14
                retn


 loc_C47:                                ; CODE XREF: main+A↑j
                 mov     rax, cs:stderr_ptr
                 mov     rdi, [rax]      ; stream
                 mov     rdx, [rbx]
                 lea     rsi, format     ; "Usage: %s <myvm program>\n"
                 xor     eax, eax
                 call    fprintf
                 jmp     short loc_C3D
 ；} // starts at BD0
 main            endp



```








## main函数伪代码分析：

![enter description here](https://s1.ax1x.com/2020/04/06/G6GdsS.png)



